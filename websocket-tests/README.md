# WebSocket 文件监控测试客户端

这个目录包含用于测试 WebSocket 文件监控功能的客户端工具。

## 📁 文件结构

```
websocket-tests/
├── index.html          # 主要的 WebSocket 测试客户端
├── start-client.sh     # 客户端启动脚本
└── README.md          # 说明文档
```

## 🚀 快速开始

### 1. 启动 API 服务器

首先确保 API 服务器正在运行：

```bash
cd claude-code-api
uv run uvicorn claude_code_api.main:app --host 0.0.0.0 --port 8080
```

### 2. 启动测试客户端

在新的终端中：

```bash
cd claude-code-api/websocket-tests
./start-client.sh
```

### 3. 打开浏览器

访问显示的客户端地址（通常是 http://0.0.0.0:3000）

## 🔧 功能特性

### 连接管理
- ✅ WebSocket 连接/断开
- ✅ 连接状态显示
- ✅ 自动重连机制

### 文件监控
- ✅ 配置监控路径
- ✅ 启动/停止监控
- ✅ 递归监控选项
- ✅ 项目 ID 配置
- ✅ 活跃监控列表

### 文件浏览
- ✅ 目录树浏览
- ✅ 文件内容查看
- ✅ 自动刷新目录树
- ✅ gitignore 风格的文件过滤

### 实时活动
- ✅ 文件变化事件显示
- ✅ 活动日志记录
- ✅ 事件类型图标化
- ✅ 忽略文件的智能过滤

## 🎯 使用步骤

1. **连接 WebSocket**
   - 点击左侧"连接"按钮
   - 等待连接状态变为"已连接"

2. **配置文件监控**
   - 输入监控路径（如 `/tmp/test-watch`）
   - 设置项目 ID
   - 选择是否递归监控
   - 点击"开始监控"

3. **浏览文件**
   - 在工具栏输入路径
   - 点击"浏览"按钮
   - 点击文件查看内容

4. **查看实时活动**
   - 右侧面板显示文件变化
   - 活动日志记录所有操作

## ⚙️ 配置选项

### 自动刷新
- 可以开启/关闭自动刷新
- 文件变化时自动更新目录树
- 智能忽略不重要的文件

### 忽略规则
系统会自动忽略以下文件/目录：
- `node_modules/`
- `.git/`
- `__pycache__/`
- `*.tmp`, `*.log`, `*.swp` 等临时文件

## 🐛 故障排除

### 连接失败
- 检查 API 服务器是否在端口 8080 运行
- 确认防火墙设置
- 查看浏览器控制台错误信息

### 监控不工作
- 确认监控路径存在且有权限
- 检查路径是否被忽略规则过滤
- 查看服务器日志

### 自动刷新问题
- 检查"自动刷新"开关是否开启
- 确认文件变化在当前浏览的目录下
- 查看活动日志中的忽略信息

## 📝 开发说明

如需修改客户端：
1. 编辑 `index.html` 文件
2. 刷新浏览器页面即可看到更改
3. 使用浏览器开发者工具调试

## 🔗 相关链接

- API 文档: http://0.0.0.0:8080/docs
- WebSocket 端点: ws://0.0.0.0:8080/v1/files/ws
